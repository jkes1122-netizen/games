<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>積動城市 - 雙方對戰數位裁判系統</title>
    <style>
        :root { --p1-color: #00acee; --p2-color: #ff4444; }
        body { background: #121212; color: #fff; font-family: sans-serif; display: flex; flex-direction: column; align-items: center; margin: 0; }
        .battle-field { display: flex; justify-content: space-around; width: 95%; margin-top: 20px; }
        .side { width: 45%; border: 1px solid #333; padding: 10px; background: #1e1e1e; }
        .turn-display { font-size: 24px; color: #f1c40f; margin: 20px; font-weight: bold; text-shadow: 0 0 10px #f1c40f; }
        .char-card { border: 2px solid #444; margin: 10px 0; padding: 10px; border-radius: 8px; position: relative; }
        .char-card.acted { opacity: 0.5; border-color: #000; background: #111; }
        .hp-bar { width: 100%; height: 12px; background: #333; border-radius: 6px; overflow: hidden; margin: 5px 0; }
        .hp-inner { width: 100%; height: 100%; background: #2ecc71; transition: width 0.3s; }
        .controls { display: flex; flex-wrap: wrap; gap: 5px; margin-top: 10px; }
        button { font-size: 12px; padding: 5px; cursor: pointer; background: #333; color: #eee; border: 1px solid #555; }
        .next-turn-btn { background: #f1c40f; color: #000; font-weight: bold; padding: 15px 40px; font-size: 18px; margin: 20px; border-radius: 30px; }
        .log-box { width: 90%; background: #000; color: #0f0; padding: 10px; height: 100px; overflow-y: scroll; font-family: monospace; }
    </style>
</head>
<body>

<div class="turn-display">⚔️ 第 <span id="turn-count">1</span> 回合 ⚔️</div>

<div class="battle-field">
    <div class="side" id="p1-side" style="border-top: 5px solid var(--p1-color);">
        <h3 style="color: var(--p1-color)">我方陣營 (SPARK)</h3>
        <div id="p1-slots"></div>
    </div>

    <div class="side" id="p2-side" style="border-top: 5px solid var(--p2-color);">
        <h3 style="color: var(--p2-color)">敵方陣營 (Enemy)</h3>
        <div id="p2-slots"></div>
    </div>
</div>

<button class="next-turn-btn" onclick="nextTurn()">結束本回合 / 下一回合</button>

<div class="log-box" id="combat-log">戰鬥初始化完成... 請開始行動。</div>

<script>
    let currentTurn = 1;
    let units = [
        { id: 0, team: 1, name: "遊騎兵 A", hp: 500, maxHp: 500, acted: false },
        { id: 1, team: 1, name: "遊騎兵 B", hp: 500, maxHp: 500, acted: false },
        { id: 2, team: 1, name: "遊騎兵 C", hp: 500, maxHp: 500, acted: false },
        { id: 3, team: 2, name: "魏延", hp: 1000, maxHp: 1000, acted: false },
        { id: 4, team: 2, name: "敵方小兵 A", hp: 300, maxHp: 300, acted: false },
        { id: 5, team: 2, name: "敵方小兵 B", hp: 300, maxHp: 300, acted: false }
    ];

    function renderUnits() {
        document.getElementById('p1-slots').innerHTML = '';
        document.getElementById('p2-slots').innerHTML = '';
        
        units.forEach(u => {
            const card = document.createElement('div');
            card.className = `char-card ${u.acted ? 'acted' : ''}`;
            const hpPercent = (u.hp / u.maxHp) * 100;
            
            card.innerHTML = `
                <strong>${u.name}</strong> (HP: ${u.hp}/${u.maxHp})
                <div class="hp-bar"><div class="hp-inner" style="width: ${hpPercent}%"></div></div>
                <div class="controls">
                    <button onclick="takeAction(${u.id}, 100, '攻擊')">一般攻擊</button>
                    <button onclick="takeAction(${u.id}, 0, '防禦')">防禦/技能</button>
                    <button onclick="heal(${u.id}, 50)">補血</button>
                </div>
            `;
            
            if (u.team === 1) document.getElementById('p1-slots').appendChild(card);
            else document.getElementById('p2-slots').appendChild(card);
        });
    }

    function takeAction(id, dmg, actionName) {
        const actor = units.find(u => u.id === id);
        if (actor.acted) return alert("該單位本回合已行動過！");
        
        // 這裡可以加入選擇目標的邏輯，目前簡化為扣除對手陣營第一個活著的人
        const target = units.find(u => u.team !== actor.team && u.hp > 0);
        if (target) {
            target.hp -= dmg;
            if (target.hp < 0) target.hp = 0;
            addLog(`${actor.name} 使用了 ${actionName}，造成 ${target.name} ${dmg} 點傷害`);
        }
        
        actor.acted = true;
        renderUnits();
    }

    function heal(id, amount) {
        const u = units.find(u => u.id === id);
        u.hp = Math.min(u.maxHp, u.hp + amount);
        addLog(`${u.name} 回復了 ${amount} 點血量`);
        renderUnits();
    }

    function nextTurn() {
        currentTurn++;
        document.getElementById('turn-count').innerText = currentTurn;
        units.forEach(u => u.acted = false);
        addLog(`--- 第 ${currentTurn} 回合開始 ---`);
        renderUnits();
    }

    function addLog(msg) {
        const log = document.getElementById('combat-log');
        log.innerHTML = `> ${msg}<br>` + log.innerHTML;
    }

    renderUnits();
</script>

</body>
</html>
